<div class="container mx-auto p-4 space-y-6">
  <!-- „Éò„ÉÉ„ÉÄ„Éº -->
  <div class="text-center">
    <h1 class="text-2xl md:text-3xl font-bold flex items-center justify-center">
      <span class="text-3xl md:text-4xl mr-3">üèÜ</span>
      „É©„É≥„Ç≠„É≥„Ç∞
    </h1>
  </div>

  <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
  <div class="tabs tabs-boxed bg-base-100 shadow-sm flex-nowrap overflow-x-auto">
    <%= link_to rankings_path(type: 'likes'), 
        class: "tab #{@ranking_type == 'likes' ? 'tab-active' : ''} whitespace-nowrap flex-shrink-0" do %>
      <span class="mr-1 md:mr-2">‚ù§Ô∏è</span>
      <span class="hidden sm:inline">„ÅÑ„ÅÑ„Å≠Êï∞</span>
      <span class="sm:hidden">„ÅÑ„ÅÑ„Å≠</span>
    <% end %>
    <%= link_to rankings_path(type: 'score'), 
        class: "tab #{@ranking_type == 'score' ? 'tab-active' : ''} whitespace-nowrap flex-shrink-0" do %>
      <span class="mr-1 md:mr-2">‚≠ê</span>
      <span class="hidden sm:inline">Ë©ï‰æ°„Çπ„Ç≥„Ç¢</span>
      <span class="sm:hidden">Ë©ï‰æ°</span>
    <% end %>
    <%= link_to rankings_path(type: 'recent'), 
        class: "tab #{@ranking_type == 'recent' ? 'tab-active' : ''} whitespace-nowrap flex-shrink-0" do %>
      <span class="mr-1 md:mr-2">üÜï</span>
      <span class="hidden sm:inline">Êñ∞ÁùÄÈ†Ü</span>
      <span class="sm:hidden">Êñ∞ÁùÄ</span>
    <% end %>
  </div>

  <% if @products.empty? %>
    <div class="alert alert-info">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
      <span>„Åæ„Å†ÂïÜÂìÅ„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ</span>
    </div>
  <% else %>
    <!-- „É©„É≥„Ç≠„É≥„Ç∞„É™„Çπ„Éà -->
    <div class="space-y-4">
      <% @products.each_with_index do |product, index| %>
        <% review = product.review %>
        <% rank = (params[:page].to_i > 0 ? params[:page].to_i - 1 : 0) * 20 + index + 1 %>
        
        <div class="card bg-white shadow-md hover:shadow-xl transition-all duration-300 border-l-4 <%= rank <= 3 ? 'border-yellow-400' : 'border-gray-200' %>">
          <div class="card-body p-0">
            <!-- „Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„É¨„Ç§„Ç¢„Ç¶„Éà -->
            <div class="hidden lg:flex items-center">
              <!-- „É©„É≥„Ç≠„É≥„Ç∞Áï™Âè∑ÔºàÁ∏¶Â∏Ø„Éá„Ç∂„Ç§„É≥Ôºâ -->
              <div class="flex-shrink-0 w-20 h-full flex flex-col items-center justify-center py-6 <%= rank <= 3 ? 'bg-gradient-to-b from-yellow-50 to-yellow-100' : 'bg-gray-50' %>">
                <% if rank == 1 %>
                  <div style="font-size: 42px; line-height: 1;">ü•á</div>
                <% elsif rank == 2 %>
                  <div style="font-size: 42px; line-height: 1;">ü•à</div>
                <% elsif rank == 3 %>
                  <div style="font-size: 42px; line-height: 1;">ü•â</div>
                <% else %>
                  <div class="font-bold text-gray-400" style="font-size: 28px; line-height: 1;">
                    <%= rank %>
                  </div>
                <% end %>
                <div class="text-xs text-gray-500 mt-1 font-medium">‰Ωç</div>
              </div>

              <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ -->
              <div class="flex-1 p-4">
                <div class="flex gap-4 items-center">
                  <!-- ÂïÜÂìÅÁîªÂÉè -->
                  <div class="flex-shrink-0">
                    <%= link_to product_path(product), class: "block" do %>
                      <div class="w-48 h-36 overflow-hidden rounded-xl bg-gray-50 shadow-sm hover:shadow-md transition-shadow flex items-center justify-center">
                        <% if product.image.attached? %>
                          <%= image_tag product.image, class: "w-full h-full object-cover hover:scale-105 transition-transform duration-300" %>
                        <% else %>
                          <div class="text-gray-400">
                            <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                          </div>
                        <% end %>
                      </div>
                    <% end %>
                  </div>

                  <!-- ÂïÜÂìÅË©≥Á¥∞ÊÉÖÂ†± -->
                  <div class="flex-1 min-w-0 max-w-md">
                    <h2 class="text-2xl font-bold mb-2 line-clamp-1">
                      <%= link_to product.name, product_path(product), class: "link link-hover text-gray-800 hover:text-blue-600 transition-colors" %>
                    </h2>
                    <div class="flex items-center gap-2 mb-3">
                      <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                      </svg>
                      <p class="text-sm text-gray-600 font-medium truncate">
                        <%= product.shop_name %>
                      </p>
                    </div>
                    
                    <% if review.comment.present? %>
                      <div class="bg-gray-50 rounded-lg p-3 mb-3 max-w-md">
                        <p class="text-sm text-gray-700 line-clamp-2 break-words">
                          "<%= review.comment.truncate(100) %>"
                        </p>
                      </div>
                    <% end %>

                    <div class="flex items-center gap-2 text-xs text-gray-500">
                      <div class="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden ring-1 ring-gray-300">
                        <% if product.user.avatar.attached? %>
                          <%= image_tag product.user.avatar, class: "w-full h-full object-cover" %>
                        <% elsif product.user.image_url.present? %>
                          <%= image_tag product.user.image_url, class: "w-full h-full object-cover" %>
                        <% else %>
                          <svg class="w-3 h-3 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                          </svg>
                        <% end %>
                      </div>
                      <span class="font-medium"><%= product.user.name %></span>
                      <span>‚Ä¢</span>
                      <span><%= product.created_at.strftime("%YÂπ¥%mÊúà%dÊó•") %></span>
                    </div>
                  </div>

                  <!-- „Éû„ÉÉ„Éó„Ç®„É™„Ç¢ -->
                  <div class="flex-shrink-0 w-80">
                    <% if product.has_location? %>
                      <div 
                        data-controller="google-map"
                        data-google-map-latitude-value="<%= product.latitude %>"
                        data-google-map-longitude-value="<%= product.longitude %>"
                        data-google-map-shop-name-value="<%= product.shop_name %>"
                        class="w-full h-32 rounded-xl bg-gray-100"
                        style="height: 128px;">
                        <p class="text-center pt-12 text-gray-400 text-xs">Âú∞Âõ≥„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                      </div>
                    <% else %>
                      <div class="w-full h-32 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl flex items-center justify-center border-2 border-dashed border-gray-300">
                        <div class="text-center">
                          <svg class="w-10 h-10 text-gray-300 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                          </svg>
                          <span class="text-xs text-gray-400 font-medium">‰ΩçÁΩÆÊÉÖÂ†±„Å™„Åó</span>
                        </div>
                      </div>
                    <% end %>
                  </div>

                  <!-- „Çπ„Ç≥„Ç¢Ë°®Á§∫„Ç®„É™„Ç¢ -->
                  <div class="flex-shrink-0">
                    <div class="text-center px-6 py-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-100 min-w-[110px]">
                      <% case @ranking_type %>
                      <% when 'likes' %>
                        <div class="text-3xl mb-2">‚ù§Ô∏è</div>
                        <div class="text-3xl font-bold text-red-600 mb-1"><%= product.likes_count %></div>
                        <div class="text-xs text-gray-600 font-semibold uppercase tracking-wide">Likes</div>
                      <% when 'score' %>
                        <div class="text-3xl mb-2">‚≠ê</div>
                        <div class="text-3xl font-bold text-yellow-600 mb-1"><%= review.score.round(1) %></div>
                        <div class="text-xs text-gray-600 font-semibold uppercase tracking-wide">Score</div>
                      <% when 'recent' %>
                        <div class="text-3xl mb-2">üÜï</div>
                        <div class="text-lg font-bold text-green-600 mb-1"><%= product.created_at.strftime("%m/%d") %></div>
                        <div class="text-xs text-gray-600 font-semibold"><%= product.created_at.strftime("%Y") %></div>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- „Çø„Éñ„É¨„ÉÉ„Éà„Éª„É¢„Éê„Ç§„É´„É¨„Ç§„Ç¢„Ç¶„Éà -->
            <div class="lg:hidden p-2">
              <!-- „É©„É≥„Ç≠„É≥„Ç∞„Éê„ÉÉ„Ç∏„Å®„Çπ„Ç≥„Ç¢ -->
              <div class="flex items-center justify-between mb-1.5">
                <!-- „É©„É≥„Ç≠„É≥„Ç∞Áï™Âè∑ -->
                <div class="flex items-center">
                  <div class="flex-shrink-0">
                    <% if rank == 1 %>
                      <div style="font-size: 28px; line-height: 1;">ü•á</div>
                    <% elsif rank == 2 %>
                      <div style="font-size: 28px; line-height: 1;">ü•à</div>
                    <% elsif rank == 3 %>
                      <div style="font-size: 28px; line-height: 1;">ü•â</div>
                    <% else %>
                      <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center">
                        <span class="font-bold text-gray-600 text-sm"><%= rank %></span>
                      </div>
                    <% end %>
                  </div>
                </div>

                <!-- „Çπ„Ç≥„Ç¢Ë°®Á§∫ -->
                <div class="flex-shrink-0">
                  <div class="text-center px-2.5 py-1 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border border-blue-100">
                    <% case @ranking_type %>
                    <% when 'likes' %>
                      <div class="text-base">‚ù§Ô∏è</div>
                      <div class="text-base font-bold text-red-600"><%= product.likes_count %></div>
                    <% when 'score' %>
                      <div class="text-base">‚≠ê</div>
                      <div class="text-base font-bold text-yellow-600"><%= review.score.round(1) %></div>
                    <% when 'recent' %>
                      <div class="text-base">üÜï</div>
                      <div class="text-xs font-bold text-green-600"><%= product.created_at.strftime("%m/%d") %></div>
                    <% end %>
                  </div>
                </div>
              </div>

              <!-- ÂïÜÂìÅÊÉÖÂ†± -->
              <div class="space-y-1.5">
                <!-- ÂïÜÂìÅÂêç„Å®„ÅäÂ∫ó -->
                <div>
                  <h2 class="text-sm md:text-base font-bold leading-tight">
                    <%= link_to product.name, product_path(product), class: "link link-hover text-gray-800 hover:text-blue-600 transition-colors" %>
                  </h2>
                  <div class="flex items-center gap-1 mt-0.5">
                    <svg class="w-3 h-3 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                    <p class="text-xs text-gray-600 font-medium truncate">
                      <%= product.shop_name %>
                    </p>
                  </div>
                </div>

                <!-- ÁîªÂÉè„Å®Âú∞Âõ≥„ÇíÊ®™‰∏¶„Å≥ -->
                <div class="flex gap-1.5">
                  <!-- ÂïÜÂìÅÁîªÂÉè -->
                  <%= link_to product_path(product), class: "block flex-1" do %>
                    <div class="w-full h-80 overflow-hidden rounded-lg bg-gray-50 shadow-sm">
                      <% if product.image.attached? %>
                        <%= image_tag product.image, class: "w-full h-full object-cover" %>
                      <% else %>
                        <div class="w-full h-full flex items-center justify-center text-gray-400">
                          <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                          </svg>
                        </div>
                      <% end %>
                    </div>
                  <% end %>

                  <!-- Âú∞Âõ≥ -->
                  <% if product.has_location? %>
                    <div class="w-2/5 overflow-hidden rounded-lg">
                      <div 
                        data-controller="google-map"
                        data-google-map-latitude-value="<%= product.latitude %>"
                        data-google-map-longitude-value="<%= product.longitude %>"
                        data-google-map-shop-name-value="<%= product.shop_name %>"
                        class="w-full h-80 bg-gray-100"
                        style="max-width: 100%;">
                        <p class="text-center pt-16 text-gray-400 text-xs">Âú∞Âõ≥„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                      </div>
                    </div>
                  <% end %>
                </div>

                <!-- „É¨„Éì„É•„Éº„Ç≥„É°„É≥„Éà -->
                <% if review.comment.present? %>
                  <div class="bg-gray-50 rounded-lg p-2.5">
                    <p class="text-xs text-gray-700 break-words leading-relaxed">
                      "<%= review.comment.truncate(120) %>"
                    </p>
                  </div>
                <% end %>

                <!-- ÊäïÁ®øËÄÖÊÉÖÂ†± -->
                <div class="flex items-center gap-2 text-xs text-gray-500 pt-1.5 border-t border-gray-100">
                  <div class="w-5 h-5 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden ring-1 ring-gray-300">
                    <% if product.user.avatar.attached? %>
                      <%= image_tag product.user.avatar, class: "w-full h-full object-cover" %>
                    <% elsif product.user.image_url.present? %>
                      <%= image_tag product.user.image_url, class: "w-full h-full object-cover" %>
                    <% else %>
                      <svg class="w-2.5 h-2.5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                      </svg>
                    <% end %>
                  </div>
                  <span class="font-medium"><%= product.user.name %></span>
                  <span>‚Ä¢</span>
                  <span class="text-xs"><%= product.created_at.strftime("%Y/%m/%d") %></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
    <div class="mt-8 flex justify-center">
      <%= paginate @products,
          first_label: '&laquo;'.html_safe,
          last_label: '&raquo;'.html_safe,
          previous_label: '&lsaquo;'.html_safe,
          next_label: '&rsaquo;'.html_safe,
          outer_window: 2,
          inner_window: 2,
          params: { type: @ranking_type } %>
    </div>
  <% end %>
</div>