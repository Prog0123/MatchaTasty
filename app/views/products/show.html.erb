<!-- Ë©≥Á¥∞„Éö„Éº„Ç∏ -->
<div class="container mx-auto p-4 space-y-6">

  <!-- ÂïÜÂìÅÊÉÖÂ†±„Ç´„Éº„Éâ -->
  <div class="bg-white rounded-lg shadow p-6 relative max-w-4xl mx-auto">

    <!-- Á∑®ÈõÜ/ÂâäÈô§„Éú„Çø„É≥ -->
    <% if user_signed_in? && @product.user == current_user %>
      <div class="absolute top-4 right-4 flex space-x-2">
        <%= link_to "Á∑®ÈõÜ", edit_product_path(@product), class: "btn btn-sm btn-outline btn-primary" %>
        <%= link_to "ÂâäÈô§", product_path(@product), data: { turbo_method: :delete, turbo_confirm: "Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" }, class: "btn btn-sm btn-outline btn-error" %>
      </div>
    <% end %>

    <!-- ÊäïÁ®øËÄÖÂêç -->
    <div class="flex items-center space-x-4 text-gray-500 text-base mb-6">
      <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
        <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <span><%= @product.user&.name || "ÂåøÂêç" %></span>
      <span class="text-gray-400 text-sm">
        <%= @product.created_at.strftime("%YÂπ¥%mÊúà%dÊó• %H:%M") %>
      </span>
    </div>

    <!-- ÂïÜÂìÅÂêç -->
    <h1 class="text-3xl font-bold mb-2"><%= @product.name %></h1>

    <!-- ÁîªÂÉè„Å®„É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà -->
    <% if @review.present? && @chart_data.present? %>
      <div class="flex flex-col md:flex-row gap-6 items-start mt-4">
        <!-- Â∑¶ÂÅ¥ÔºöÂïÜÂìÅÁîªÂÉè„Å®Ë©≥Á¥∞ÊÉÖÂ†± -->
        <div class="w-full md:w-1/2 space-y-4">
          <!-- ÂïÜÂìÅÁîªÂÉè -->
          <% if @product.image.attached? %>
            <%= image_tag @product.image, class: "w-full max-w-sm object-cover rounded shadow mb-4" %>
          <% else %>
            <div class="w-full h-64 bg-gray-100 flex items-center justify-center rounded">No Image</div>
          <% end %>

          <!-- ÂïÜÂìÅË©≥Á¥∞ÊÉÖÂ†± -->
          <div class="grid grid-cols-2 gap-4 max-w-sm mt-10">
            <!-- Â∫óËàóÂêç„Éª‰æ°Ê†º -->
            <div>
              <h4 class="font-semibold text-gray-700 text-base mb-1">Â∫óËàóÂêç</h4>
              <p class="text-gray-600 text-base"><%= @product.shop_name.present? ? @product.shop_name : "Êú™Ë®≠ÂÆö" %></p>
            </div>
            <div>
              <h4 class="font-semibold text-gray-700 text-base mb-1">‰æ°Ê†º</h4>
              <p class="text-gray-600 text-base"><%= @product.price.present? ? "#{number_with_delimiter(@product.price)}ÂÜÜ" : "Êú™Ë®≠ÂÆö" %></p>
            </div>

            <!-- „Ç´„ÉÜ„Ç¥„É™„Éª„Çø„Ç∞ -->
            <div>
              <h4 class="font-semibold text-gray-700 text-base mb-1">„Ç´„ÉÜ„Ç¥„É™</h4>
              <p class="text-gray-600 text-base"><%= @product.category_japanese %></p>
            </div>
            <div>
              <h4 class="font-semibold text-gray-700 text-base mb-1">„Çø„Ç∞</h4>
              <% if @product.tags.present? %>
                <div class="flex flex-wrap gap-1">
                  <% @product.tags.each do |tag| %>
                    <%= link_to products_path(tag: tag.name), class: "badge badge-xs badge-outline hover:badge-primary transition-colors cursor-pointer" do %>
                      <%= tag.name %>
                    <% end %>
                  <% end %>
                </div>
              <% else %>
                <p class="text-gray-600 text-base">„Å™„Åó</p>
              <% end %>
            </div>

            <!-- ÊøÉ„Åï„ÉªÁ∑èÂêàË©ï‰æ° -->
            <div>
              <h4 class="font-semibold text-gray-700 text-base mb-1">ÊøÉ„Åï</h4>
              <div class="flex items-center space-x-1">
                <div class="flex">
                  <% @review.richness.to_i.times do %>
                    <span class="text-green-600 text-base">üçµ</span>
                  <% end %>
                </div>
                <span class="text-xs font-bold text-gray-600"><%= @review.richness.to_i %>/5</span>
              </div>
            </div>
            <div>
              <h4 class="font-semibold text-gray-700 text-base mb-1">Á∑èÂêàË©ï‰æ°</h4>
              <% if @average_score.present? %>
                <div class="flex items-center space-x-1">
                  <div class="flex">
                    <% 5.times do |i| %>
                      <% if i < @average_score.round %>
                        <span class="text-yellow-400 text-base">‚òÖ</span>
                      <% else %>
                        <span class="text-gray-300 text-base">‚òÖ</span>
                      <% end %>
                    <% end %>
                  </div>
                  <span class="text-xs font-bold text-gray-600"><%= number_with_precision(@average_score, precision: 1) %>/5.0</span>
                </div>
              <% else %>
                <p class="text-gray-500 text-base">Êú™Ë©ï‰æ°</p>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Âè≥ÂÅ¥Ôºö„É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà„Å®„É¨„Éì„É•„Éº -->
        <div class="w-full md:w-1/2 space-y-6">
          <!-- „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà -->
          <div class="flex justify-center">
            <div class="chart-container" style="height: 300px; width: 300px;">
              <canvas
                data-controller="review-radar"
                data-review-radar-data-value="<%= @chart_data[:chart_config].to_json %>"
                width="300"
                height="300">
              </canvas>
            </div>
          </div>

          <!-- „É¨„Éº„ÉÄ„Éº„ÉÅ„É£„Éº„Éà„ÅÆÊï∞ÂÄ§Ë°®Á§∫ -->
          <div class="bg-gray-50 p-4 rounded">
            <h4 class="font-semibold text-gray-700 mb-3 text-center">Ë©ï‰æ°Ë©≥Á¥∞</h4>
            <div class="grid grid-cols-2 gap-3">
              <% @chart_data[:values].each do |item| %>
                <div class="flex justify-between items-center">
                  <span class="text-base text-gray-600"><%= item[:label] %></span>
                  <span class="text-base font-bold text-gray-800"><%= item[:value].to_i %>/5</span>
                </div>
              <% end %>
            </div>
          </div>

          <!-- „É¨„Éì„É•„Éº„Ç≥„É°„É≥„Éà -->
          <% if @review.comment.present? %>
            <div class="bg-gray-50 p-4 rounded">
              <h4 class="font-semibold text-gray-700 mb-2">„É¨„Éì„É•„Éº</h4>
              <p class="text-base text-gray-600"><%= simple_format(@review.comment) %></p>
            </div>
          <% end %>

          <!-- X„Ç∑„Çß„Ç¢„Éú„Çø„É≥„ÉªÊäïÁ®øÊó•„Éª„ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ÔºàÊ®™‰∏¶„Å≥Ë°®Á§∫Ôºâ -->
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <!-- X„Ç∑„Çß„Ç¢„Éú„Çø„É≥ -->
            <div  class="sm:ml-auto">
              <button class="inline-flex items-center px-4 py-2 bg-gray-300 text-gray-500 text-sm font-medium rounded-lg cursor-not-allowed" disabled>
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
                X„Åß„Ç∑„Çß„Ç¢ÔºàÊ∫ñÂÇô‰∏≠Ôºâ
              </button>
            </div>

            <!-- „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ÔºàË©≥Á¥∞„Éö„Éº„Ç∏Áî®Ôºâ -->
            <% if @review.present? %>
              <%= render "likes/like_button", review: @review, size: "md" %>
            <% end %>
          </div>

          </div>
        </div>
      </div>
    <% end %>

    <!-- „É¨„Éì„É•„Éº„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆË°®Á§∫ -->
    <% unless @review.present? && @chart_data.present? %>
      <div class="mt-6 pt-6 border-t border-gray-200">
        <p class="text-gray-500">„Åæ„Å†„É¨„Éì„É•„Éº„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
      </div>
    <% end %>

  </div>

<!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
<div class="bg-white rounded-lg shadow p-6 max-w-4xl mx-auto">
  <h2 class="text-2xl font-semibold mb-6">„Ç≥„É°„É≥„Éà</h2>

  <% if @review.present? %>
    <div class="space-y-6">
      <!-- „Ç≥„É°„É≥„ÉàÊäïÁ®ø„Éï„Ç©„Éº„É† -->
      <div id="comment-form">
        <%= render "comments/comment_form", review: @review %>
      </div>

      <!-- „Ç≥„É°„É≥„Éà‰∏ÄË¶ß -->
      <div id="comments-list" class="space-y-4">
        <% if @review.comments.newest_first.any? %>
          <p class="text-sm text-gray-600 mb-4">
            <%= @review.comments.count %>‰ª∂„ÅÆ„Ç≥„É°„É≥„Éà
          </p>
          <%= render @review.comments.newest_first, collection: @review.comments.newest_first, as: :comment %>
        <% else %>
          <p class="text-center text-gray-500 py-8">
            „Åæ„Å†„Ç≥„É°„É≥„Éà„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ
          </p>
        <% end %>
      </div>
    </div>
  <% else %>
    <p class="text-gray-500">„É¨„Éì„É•„Éº„Åå„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Ç≥„É°„É≥„ÉàÊ©üËÉΩ„ÅØÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ</p>
  <% end %>
</div>

  <!-- Êàª„Çã„Éú„Çø„É≥ -->
  <div class="max-w-4xl mx-auto flex mt-4 mb-4">
    <%= link_to "ÂïÜÂìÅ‰∏ÄË¶ß„Å´Êàª„Çã", products_path, class: "btn btn-outline" %>
  </div>
</div>