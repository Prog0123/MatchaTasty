<div class="pt-8 pb-4">
  <div class="max-w-2xl w-full mx-auto px-4">
    <!-- プログレスバー（100%完了） -->
    <div class="bg-gray-200 rounded-full h-2.5 mb-2">
      <div class="bg-primary h-2.5 rounded-full transition-all duration-300 ease-in-out" style="width: 100%;"></div>
    </div>

    <!-- タイトル -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">入力内容の確認</h1>
      <p class="text-gray-600">以下の内容で投稿します。よろしければ「投稿する」ボタンを押してください。</p>
    </div>


    <!-- 確認カード -->
    <div class="card bg-white shadow-xl p-6 rounded-xl mb-4">
      
      <!-- 商品情報セクション -->
      <div class="mb-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-primary pb-2">📦 商品情報</h2>
        
        <div class="grid grid-cols-1 gap-4">
          <!-- 商品名 -->
          <div class="flex flex-col sm:flex-row border-b pb-3">
            <div class="w-full sm:w-32 font-semibold text-gray-700 mb-1 sm:mb-0">商品名</div>
            <div class="flex-1 text-gray-900"><%= @product.name %></div>
          </div>

          <!-- 店舗名 -->
          <div class="flex flex-col sm:flex-row border-b pb-3">
            <div class="w-full sm:w-32 font-semibold text-gray-700 mb-1 sm:mb-0">店舗名</div>
            <div class="flex-1 text-gray-900"><%= @product.shop_name %></div>
          </div>

          <!-- カテゴリ -->
          <div class="flex flex-col sm:flex-row border-b pb-3">
            <div class="w-full sm:w-32 font-semibold text-gray-700 mb-1 sm:mb-0">カテゴリ</div>
            <div class="flex-1">
              <span class="badge badge-primary"><%= @product.category_japanese %></span>
            </div>
          </div>

          <!-- 価格 -->
          <div class="flex flex-col sm:flex-row border-b pb-3">
            <div class="w-full sm:w-32 font-semibold text-gray-700 mb-1 sm:mb-0">価格</div>
            <div class="flex-1 text-gray-900 font-bold"><%= number_with_delimiter(@product.price) %>円</div>
          </div>

          <!-- タグ -->
          <% tag_names = session[:product_draft]['tag_names'] %>
          <% if tag_names.present? %>
            <div class="flex flex-col sm:flex-row border-b pb-3">
              <div class="w-full sm:w-32 font-semibold text-gray-700 mb-1 sm:mb-0">タグ</div>
              <div class="flex-1">
                <div class="flex flex-wrap gap-2">
                  <% tag_names.split(",").map(&:strip).reject(&:blank?).each do |tag| %>
                    <span class="badge badge-outline"><%= tag %></span>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- 画像セクション - 商品情報の直後に移動 -->
      <% if @image_data_url.present? %>
        <div class="mb-6">
          <h2 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-primary pb-2">📷 商品画像</h2>
          <div class="flex justify-center">
            <%= image_tag @image_data_url, 
                class: "max-w-full h-auto rounded-lg shadow-md", 
                style: "max-height: 400px; object-fit: cover;" %>
          </div>
        </div>
      <% end %>

      <!-- 味覚評価セクション -->
      <div class="mb-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-primary pb-2">⭐ 味覚評価</h2>
        
        <div class="grid grid-cols-1 gap-3">
          <% [
            ["濃さ", @review.richness],
            ["甘さ", @review.sweetness],
            ["苦味", @review.bitterness],
            ["後味", @review.aftertaste],
            ["見た目", @review.appearance]
          ].each do |label, value| %>
            <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg hover:bg-gray-100 transition-colors">
              <span class="font-semibold text-gray-700 w-16"><%= label %></span>
              <div class="flex items-center gap-3 flex-1 justify-end">
                <div class="flex">
                  <% 5.times do |i| %>
                    <span class="text-xl <%= i < value ? 'text-yellow-400' : 'text-gray-300' %>">★</span>
                  <% end %>
                </div>
                <span class="text-lg font-bold text-gray-700 w-16 text-right"><%= value %> / 5.0</span>
              </div>
            </div>
          <% end %>
        </div>

        <!-- 平均スコア表示 - 改善版 -->
        <% 
          scores = [@review.richness, @review.sweetness, @review.bitterness, @review.aftertaste, @review.appearance].compact
          average = scores.any? ? (scores.sum.to_f / scores.size).round(1) : 0.0
        %>
        <div class="mt-6 text-center bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300 p-6 rounded-xl shadow-sm">
          <div class="text-sm font-semibold text-gray-600 mb-2">総合評価</div>
          <div class="flex items-baseline justify-center gap-1">
            <div class="text-5xl font-bold text-yellow-600"><%= average %></div>
            <div class="text-2xl font-bold text-gray-500">/</div>
            <div class="text-3xl font-bold text-gray-500">5.0</div>
          </div>
          <div class="mt-3 flex justify-center">
            <% 5.times do |i| %>
              <span class="text-2xl <%= i < average.round ? 'text-yellow-400' : 'text-gray-300' %>">★</span>
            <% end %>
          </div>
        </div>
      </div>

      <!-- コメントセクション -->
      <% if @review.comment.present? %>
        <div class="mb-6">
          <h2 class="text-xl font-bold text-gray-800 mb-4 border-b-2 border-primary pb-2">💬 コメント</h2>
          <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
            <p class="text-gray-800 whitespace-pre-wrap leading-relaxed"><%= @review.comment %></p>
          </div>
        </div>
      <% end %>
    </div>

    <!-- ボタン -->
    <%= form_with url: products_path, method: :post, local: true do |f| %>
      <div class="flex flex-col sm:flex-row gap-4 justify-center mt-6">
        <%= link_to "← 内容を修正する", new_product_path, class: "btn btn-secondary btn-lg" %>
        <%= button_to "投稿する ✓", products_path, method: :post, class: "btn btn-primary btn-lg", data: { confirm: "この内容で投稿しますか?" } %>
      </div>
    <% end %>

    <!-- 注意書き -->
    <div class="text-center mt-6 text-sm text-gray-500">
      ※ 投稿後も編集・削除が可能です
    </div>
  </div>
</div>

<style>
/* スマホ対応の追加スタイル */
@media (max-width: 640px) {
  .text-5xl {
    font-size: 2.5rem;
  }
  
  .text-3xl {
    font-size: 1.875rem;
  }
  
  .card {
    padding: 1rem;
  }
}
</style>