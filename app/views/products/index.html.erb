<div class="container mx-auto p-4 space-y-6">

  <!-- „Éò„ÉÉ„ÉÄ„Éº„Å®Êñ∞Ë¶è‰ΩúÊàê„Éú„Çø„É≥ -->
  <div class="flex justify-between items-center">
    <h1 class="text-2xl font-bold">ÂïÜÂìÅ‰∏ÄË¶ß</h1>
    <%= link_to "Ôºã Êñ∞Ë¶èÊäïÁ®ø", new_product_path, class: "btn btn-secondary" %>
  </div>

  <!-- Ê§úÁ¥¢„Éï„Ç©„Éº„É† -->
  <div class="card bg-base-100 p-4 shadow">
    <%= search_form_for @q, url: products_path, method: :get, class: "flex flex-col md:flex-row gap-4" do |f| %>
      <div class="flex-2">
        <%= f.label :name_cont, "ÂïÜÂìÅÂêç", class: "label-text" %>
        <%= f.search_field :name_cont, class: "input input-bordered w-full" %>
      </div>
      <div class="flex-1">
        <%= f.label :category_eq, "„Ç´„ÉÜ„Ç¥„É™", class: "label-text" %>
        <%= f.select :category_eq,
              options_for_select(
                Product::CATEGORY_TRANSLATIONS.map { |key, value| [value, Product.categories[key]] },
                params.dig(:q, :category_eq)
              ),
              { include_blank: "„Åô„Åπ„Å¶" },
              { class: "select select-bordered w-full" } %>
      </div>
      <div class="self-end">
        <%= f.submit "Ê§úÁ¥¢", class: "btn btn-secondary w-full md:w-auto" %>
      </div>
    <% end %>
  </div>

  <!-- ÂïÜÂìÅ„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÊôÇ -->
  <% if @products.empty? %>
    <div class="alert alert-warning">ÂïÜÂìÅ„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ</div>
  <% else %>

    <!-- ÂïÜÂìÅ‰∏ÄË¶ß -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3">
      <% @products.each do |product| %>
        <div class="card bg-white shadow-sm">

          <!-- ÊäïÁ®øËÄÖ„Ç¢„Ç§„Ç≥„É≥ÔºãÂêçÂâç -->
          <div class="flex items-center px-2 py-2 space-x-1">
            <div class="w-5 h-5 bg-gray-200 rounded-full flex items-center justify-center">
              <svg class="w-3 h-3 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <span class="text-xs text-gray-500 truncate">
              <%= product.user&.name || "ÂåøÂêç" %>
            </span>
          </div>

          <figure class="h-32 overflow-hidden">
            <%= link_to product_path(product) do %>
              <% if product.image.attached? %>
                <%= image_tag product.image, class: "w-full object-contain h-full bg-gray-50 hover:opacity-90 transition-opacity cursor-pointer" %>
              <% else %>
                <div class="flex items-center justify-center w-full h-full text-gray-400 text-sm bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer">ÁîªÂÉè„Å™„Åó</div>
              <% end %>
            <% end %>
          </figure>

          <div class="card-body p-3">
            <h2 class="text-sm font-semibold leading-tight mb-1">
              <%= link_to product.name, product_path(product), class: "link link-hover line-clamp-2" %>
            </h2>

            <!-- „Çø„Ç∞Ë°®Á§∫ -->
            <% if product.tags.any? %>
              <div class="flex flex-wrap gap-1 mb-1">
                <% product.tags.first(2).each do |tag| %>
                  <%= link_to products_path(q: { name_cont: "", category_eq: "", tag: tag.name }), class: "badge badge-xs badge-outline text-xs hover:badge-primary transition-colors cursor-pointer" do %>
                    <%= tag.name %>
                  <% end %>
                <% end %>
                <% if product.tags.size > 2 %>
                  <span class="text-xs text-gray-400">+<%= product.tags.size - 2 %></span>
                <% end %>
              </div>
            <% else %>
              <p class="text-xs text-gray-400 mb-1">„Çø„Ç∞„Å™„Åó</p>
            <% end %>

            <% if product.review %>
              <!-- ÊøÉ„Åï -->
              <div class="flex items-center space-x-1">
                <% product.review.richness.to_i.times do %>
                  <span class="text-green-600 text-xs">üçµ</span>
                <% end %>
                <span class="text-xs font-bold"><%= product.review.richness.to_i %>/5</span>
              </div>
            <% else %>
              <p class="text-gray-400 text-xs">„É¨„Éì„É•„Éº„Å™„Åó</p>
            <% end %>

            <!-- ÊäïÁ®øÊó•„Å®„ÅÑ„ÅÑ„Å≠„Éª„Ç≥„É°„É≥„ÉàÊï∞ÔºàÊ®™‰∏¶„Å≥Ôºâ -->
            <div class="flex items-center justify-between">
              <p class="text-xs text-gray-400">
                <%= product.created_at.strftime("%y/%m/%d") %>
              </p>
              <% if product.review %>
                <div class="flex items-center space-x-1">
                  <!-- „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ -->
                  <%= render "likes/like_button", review: product.review, size: "sm" %>
                  <!-- „Ç≥„É°„É≥„ÉàÊï∞ -->
                  <div class="flex items-center space-x-1">
                    <span class="text-sm">üí¨</span>
                    <span class="text-xs text-gray-600"><%= product.review.comments.count %></span>
                  </div>
                </div>
              <% end %>
            </div>

          </div>
        </div>
      <% end %>
    </div>

    <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
    <div class="mt-8 flex justify-center">
      <%= paginate @products,
          first_label: '&laquo;'.html_safe,
          last_label: '&raquo;'.html_safe,
          previous_label: '&lsaquo;'.html_safe,
          next_label: '&rsaquo;'.html_safe,
          outer_window: 2,
          inner_window: 2 %>
    </div>

  <% end %>
</div>
