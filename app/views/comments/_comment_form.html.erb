<div class="bg-white p-4 rounded-lg border border-gray-200">
  <% if user_signed_in? %>
    <%= form_with model: [review, Comment.new], local: true, class: "space-y-3" do |f| %>
      <div>
        <%= f.label :text, "コメントを投稿", class: "block text-sm font-semibold text-gray-700 mb-2" %>
        <%= f.text_area :text,
            placeholder: "コメントを入力してください（最大500文字）",
            class: "w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",
            rows: 4,
            maxlength: 500 %>
        <p class="text-xs text-gray-500 mt-1">
          文字数: <span id="char-count">0</span>/500
        </p>
      </div>

      <%= f.submit "送信", class: "btn btn-sm btn-primary w-full" %>
    <% end %>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const textarea = document.querySelector('textarea[name="comment[text]"]');
        const charCount = document.getElementById('char-count');

        textarea.addEventListener('input', function() {
          charCount.textContent = this.value.length;
        });
      });
    </script>
  <% else %>
    <p class="text-center text-gray-600 py-4">
      <%= link_to "ログイン", new_user_session_path, class: "link link-primary" %>
      してコメントを投稿
    </p>
  <% end %>
</div>